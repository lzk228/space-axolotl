using Content.Client.Guidebook;
using Content.Shared.Guidebook;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Prototypes;

namespace Content.Client.UserInterface.Controls;

[GenerateTypedNameReferences]
public sealed partial class HelpButton : Control
{
    [Dependency]
    private readonly IEntitySystemManager _entitySystemManager = default!;
    private readonly GuidebookSystem? _guidebookSystem;

    private List<ProtoId<GuideEntryPrototype>>? _entries;

    public List<ProtoId<GuideEntryPrototype>>? Entries
    {
        get => _entries;
        set
        {
            _entries = value;
            Button.Disabled = _entries is null || _entries.Count == 0;
            Button.Visible = !Button.Disabled;
        }
    }

    public HelpButton()
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);

        _guidebookSystem = _entitySystemManager.GetEntitySystem<GuidebookSystem>();

        Button.OnPressed += _ => Help();
    }

    private void Help()
    {
        if (_entries is null || _entries.Count == 0)
            return;

        _guidebookSystem?.OpenHelp(_entries);
    }
}
